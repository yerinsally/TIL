-- WHERE 조건 총 4개
-- 1. 대여 기간의 시작일='2022-11-30'이전 & 종료일='2022-11-01'이후인 테이블 제외
-- 2. 30D일 이상의 할인율만 추출
-- 3. 세단, SUV만 추출
-- 4. 30일 대여금액이 50만원~200만원 사이만 추출
SELECT A.CAR_ID, A.CAR_TYPE, ROUND(30*A.DAILY_FEE*(1-B.DISCOUNT_RATE/100),0) AS FEE
FROM CAR_RENTAL_COMPANY_CAR AS A
JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN AS B ON A.CAR_TYPE=B.CAR_TYPE
WHERE CAR_ID NOT IN (SELECT CAR_ID
                     FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
                     WHERE END_DATE >= '2022-11-01' AND START_DATE <= '2022-11-30')
    AND B.DURATION_TYPE LIKE '30일%'
    AND A.CAR_TYPE IN ('세단','SUV')
    AND ROUND(30*A.DAILY_FEE*(1-B.DISCOUNT_RATE/100),0) BETWEEN 500000 AND 2000000
ORDER BY FEE DESC, CAR_TYPE, CAR_ID DESC
